(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{673:function(e,t,a){e.exports=a.p+"assets/img/firstimage.329e6e43.png"},674:function(e,t,a){e.exports=a.p+"assets/img/php1.1bb4d4c2.png"},675:function(e,t,a){e.exports=a.p+"assets/img/php2.3ce706f8.png"},676:function(e,t,a){e.exports=a.p+"assets/img/php3.bb4f2e39.png"},778:function(e,t,a){"use strict";a.r(t);var s=a(42),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"challenge-4-image-and-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#challenge-4-image-and-registry"}},[e._v("#")]),e._v(" Challenge 4: Image and Registry")]),e._v(" "),s("h2",{attrs:{id:"here-is-what-you-ll-learn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-ll-learn"}},[e._v("#")]),e._v(" Here is what you'll learn")]),e._v(" "),s("ul",[s("li",[e._v("Tagging")]),e._v(" "),s("li",[e._v("Image pull and push")]),e._v(" "),s("li",[e._v("Building your own image")]),e._v(" "),s("li",[e._v("Image registries and repositories")])]),e._v(" "),s("p",[e._v("In this challenge, we're gonna play with Docker Images. A Docker container image is a lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries and settings.")]),e._v(" "),s("h2",{attrs:{id:"exercises"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exercises"}},[e._v("#")]),e._v(" Exercises")]),e._v(" "),s("p",[s("strong",[e._v("1: Tagging")])]),e._v(" "),s("p",[e._v("Let's pull an image. The command that we use is "),s("code",[e._v("docker pull")]),e._v(". With that command, we're requesting from Docker that we want to download this image from its registry to our machine.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker pull ubuntu:latest\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("latest: Pulling from library/ubuntu\n3ff22d22a855: Pull complete\ne7cb79d19722: Pull complete\n323d0d660b6a: Pull complete\nb7f616834fd0: Pull complete\nDigest: sha256:5d1d5407f353843ecf8b16524bc5565aa332e9e6a1297c73a92d3e754b8a636d\nStatus: Downloaded newer image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" ubuntu:latest\ndocker.io/library/ubuntu:latest\n")])])]),s("p",[e._v("Now it's time to see which images that we have on our system. For this, we're gonna type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              latest              1e4467b07108        "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("73")]),e._v(".9MB\n")])])]),s("p",[e._v("I want you to pay attention to the image id part. Like containers, images also have unique ids. The image ID is a digest, and is a computed SHA256 hash of the image configuration object, which contains the digests of the layers that contribute to the image's filesystem definition. If two different images have the same ids, this means that they're literally the same images with different names.\nYes it's possible to tag an image with different tags. Let's do that and add another name to this image.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image tag ubuntu:latest your_dockerhub_id/day6:ubuntu\n")])])]),s("p",[e._v("Now we have added a second name to the same image. Let's check and see.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\nubuntu                latest              1e4467b07108        "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("73")]),e._v(".9MB\nozgurozturknet/day6   ubuntu              1e4467b07108        "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("73")]),e._v(".9MB\n")])])]),s("p",[e._v("We have 2 images stored on our computers. But image ids are same, so these are literally the same image but with different names.")]),e._v(" "),s("p",[e._v("We have tagged the image with our Docker Hub id and actually this means that this image is stored on Docker Hub (Remember, image names are also indicates where the image is located). But it isn't at the moment. Let's correct this and push this image to its repository. But before that we have to login and authenticate. In this way, Docker Hub knows that we're the right person who can push image to this registry. Let's login first.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker login\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" over to https://hub.docker.com to create one.\nUsername: ozgurozturknet\nPassword:\nLogin Succeeded\n")])])]),s("p",[e._v("Now we're ready to push.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker push your_dockerhub_id/day6:ubuntu\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("The push refers to repository "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("docker.io/ozgurozturknet/day6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n095624243293: Mounted from library/ubuntu\na37e74863e72: Mounted from library/ubuntu\n8eeb4a14bcb4: Mounted from library/ubuntu\nce3011290956: Mounted from library/ubuntu\nubuntu: digest: sha256:60f560e52264ed1cb7829a0d59b1ee7740d7580e0eb293aca2d722136edb1e24 size: 11529MB\n")])])]),s("p",[e._v("It is fast. Isn't it? Please pay attention to the output. "),s("code",[e._v("Mounted from library/ubuntu")]),e._v(". You know that images consist of multiple layers. And each layer has it's unique id. When we pull or push any image, if the target (registry or your computer) has the layer with that id already stored on it, it doesn't pull or push that layer again. Just checks the file which is already stored on it and mounts that. This is the reason why it was fast. We didn't transfer any file to Docker Hub. Docker Hub detected that these 4 layers are already stored on it, so instead of getting it again, Docker hub just mounted these files to our repository. This is also same on our computer. We have 2 images stored on it. But they are literally the same images with different names. Docker doesn't store multiple files for these 2 images. The image files are stored just once but multiple tags added to the same files.")]),e._v(" "),s("p",[e._v("But what are these layers? Is there any way to see how are they created? Yes and the command that we'll use is "),s("code",[e._v("docker image history")]),e._v(". History sub-command shows us the history of the image and it shows how all layers are created. Let's check this.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("history")]),e._v(" ubuntu:latest\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("1e4467b07108        "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         /bin/sh -c "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('#(nop)  CMD ["/bin/bash"]            0B')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("           "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         /bin/sh -c "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p /run/systemd "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'doâ€¦   7B\n<missing>           2 weeks ago         /bin/sh -c set -xe   && echo '")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#!/bin/sh' > /â€¦   811B")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("           "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         /bin/sh -c "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" -z "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" indextargets"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v('"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(".01MB\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("           "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" weeks ago         /bin/sh -c "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#(nop) ADD file:65a1cc50a9867c153â€¦   72.9MB")]),e._v("\n")])])]),s("p",[e._v("Output shows us how these layers have been created. Which commands have been executed and these layers have been created as a result of these commands. This also shows us how an image is created.")]),e._v(" "),s("p",[e._v("Docker can build images automatically by reading the instructions from a Dockerfile. A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image. Using docker build users can create an automated build that executes several command-line instructions in succession. Each instruction that changes anything creates a new layer. The Docker daemon runs the instructions in the Dockerfile one-by-one, committing the result of each instruction to a new image if necessary, before finally outputting the ID of your new image. It's now time to create our first image.")]),e._v(" "),s("hr"),e._v(" "),s("p",[s("strong",[e._v("2: Building the first image")])]),e._v(" "),s("p",[e._v("First, we're gonna clone this Github repository.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/azuredevcollege/trainingdays.git\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Cloning into "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'trainingdays'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\nremote: Enumerating objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("42")]),e._v(", done.\nremote: Counting objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("42")]),e._v("/42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", done.\nremote: Compressing objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("31")]),e._v("/31"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", done.\nremote: Total "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1899")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("delta "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("26")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", reused "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("25")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("delta "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", pack-reused "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1857")]),e._v(" Receiving objects:  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("97")]),e._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1843")]),e._v("/1899"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("57.20")]),e._v(" MiB "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11.92")]),e._v(" MiB/s\nReceiving objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1899")]),e._v("/1899"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("63.35")]),e._v(" MiB "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11.26")]),e._v(" MiB/s, done.\nResolving deltas: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("747")]),e._v("/747"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", done.\nUpdating files: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1396")]),e._v("/1396"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", done.\n")])])]),s("p",[e._v("Repo has been cloned. It's time to enter the "),s("code",[e._v("/trainingdays/day6/apps/first_docker_image")]),e._v(". cd to that folder and list all the files.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /trainingdays/day6/apps/first_docker_image\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" -l\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("total "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("90")]),e._v(" Jun "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":56 Dockerfile\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("211")]),e._v(" Jun "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":21 index.html\n")])])]),s("p",[e._v("There are 2 files in the folder. "),s("code",[e._v("index.html")]),e._v(" is a simple html file that has been created by us. We want to build an image that includes and serves that image. To build an image, we use "),s("code",[e._v("Dockerfile")]),e._v(". A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image. We have one in this folder. Let's check what's in it.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" Dockerfile\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("FROM nginx:latest\nCOPY index.html /usr/share/nginx/html\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nginx"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-g"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"daemon off;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),s("p",[e._v("This is one of the simplest Dockerfile. When we type "),s("code",[e._v("docker image build .")]),e._v(" in the folder that any Dockerfile presents, Docker starts to run instructions in that Dockerfile in order. A Dockerfile must begin with a FROM instruction. The FROM instruction specifies the Parent Image from which you are building. "),s("code",[e._v("FROM")]),e._v(' basically means that "hey Docker, download that image and execute the next instructions on top of that image". It\'s the base image that we build our image on top of. In our case, it is '),s("code",[e._v("nginx:latest")]),e._v(". We're building our image on top of that image.")]),e._v(" "),s("p",[e._v("The second instruction in that Dockerfile is "),s("code",[e._v("COPY")]),e._v('. The COPY instruction copies new files or directories from "source" and adds them to the filesystem of the container at the path "destination". In our case, we\'re instructing Docker to copy the '),s("code",[e._v("index.html")]),e._v(" file on the current folder to the "),s("code",[e._v("/usr/share/nginx/html")]),e._v(" folder inside the image. "),s("code",[e._v("/usr/share/nginx/html")]),e._v(" is the folder where Nginx stores the websites that it serves. Thus when Nginx daemon runs, it serves our website.")]),e._v(" "),s("p",[e._v("The third and last instruction is CMD. The main purpose of a CMD is to provide defaults for an executing container. In short, it defines the command to execute when you run a container from that image. There can only be one CMD instruction in a Dockerfile. If you list more than one CMD then only the last CMD will take effect. In our case, we want Docker to start nginx daemon when we create a container.")]),e._v(" "),s("p",[e._v("Ok, it's time to create our first image. We checked the Dockerfile and learned what it includes. Now we can build the first image.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image build -t your_dockerhub_id/firstimage:latest "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(".072kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/3 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM nginx:latest\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 08393e824c32\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/3 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY index.html /usr/share/nginx/html\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 14fb48dc6eea\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/3 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nginx"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-g"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"daemon off;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 772fbfd4dba3\nRemoving intermediate container 772fbfd4dba3\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 560570bf44e5\nSuccessfully built 560570bf44e5\nSuccessfully tagged ozgurozturknet/firstimage:latest\n")])])]),s("p",[e._v("Congrats. We have built our first image. Let's try if it's working as expect. Let's create a container and see.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container run --rm -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(":80 --name test_container your_dockerhub_id/firstimage:latest\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("25e7fe3f3e57dd2eab07bf672501dde69d81eb156347607e0b378757b41d859b\n")])])]),s("p",[e._v("Open a browser and visit http://127.0.0.1 You would see a page like that.")]),e._v(" "),s("img",{attrs:{src:a(673)}}),e._v(" "),s("p",[e._v("Stop the container and it'll be deleted.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container stop test_container\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("test_container\n")])])]),s("hr"),e._v(" "),s("p",[s("strong",[e._v("3: Building a nodejs image")])]),e._v(" "),s("p",[e._v("This time we're gonna build a nodejs app image. Enter the "),s("code",[e._v("/trainingdays/day6/apps/nodejs")]),e._v(" folder and list all the files.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /trainingdays/day6/apps/nodejs\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" -l\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("total "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("292")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),e._v(":27 Dockerfile\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("288")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),e._v(":14 package.json\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("273")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),e._v(":15 server.js\n")])])]),s("p",[e._v("This time we have 3 files. First one is "),s("code",[e._v("package.json")]),e._v(". If you work with JavaScript, or you've ever interacted with a JavaScript project, Node.js or a frontend project, you surely met the package.json file. The package.json file is kind of a manifest for your project. It can do a lot of things, but in our case it's specially important because it defines the dependencies that we'll install with npm. Our simple node application is running on top of Express framework and we need that framework to be installed to run our simple Javascript webapp. "),s("code",[e._v("Server.js")]),e._v(" is the second file and it's our main Javascript application. It's a simple Hello World web app. And the third one is the usual suspect. Dockerfile. Let's take a look at it.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" Dockerfile\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# source: https://nodejs.org/en/docs/guides/nodejs-docker-webapp/")]),e._v("\nFROM node:12\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Create app directory")]),e._v("\nWORKDIR /usr/src/app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Copy source files")]),e._v("\nCOPY package.json "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\nCOPY server.js "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Install app dependencies")]),e._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Exposing the port 8080")]),e._v("\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8080")]),e._v("\n\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"server.js"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),s("p",[e._v("I want you to pay attention to 2 things. First, as you can see, we can add comments to Dockerfile. Any line starting with "),s("code",[e._v("#")]),e._v(" is treated as a comment and not processed. Second, we have 3 new instructions, "),s("code",[e._v("WORKDIR")]),e._v(" , "),s("code",[e._v("RUN")]),e._v(" and "),s("code",[e._v("EXPOSE")]),e._v(". The default working directory for running binaries within a container is the root directory (/), but the you can set a different default with the Dockerfile WORKDIR command. It's kind of cd'ing to that folder. And any command that you execute after that will be executed in that folder. If the folder is not in the image, Docker creates tht folder.")]),e._v(" "),s("p",[e._v("The RUN instruction will execute any commands in a new layer on top of the current image and commit the results. The resulting committed image will be used for the next step in the Dockerfile. When we want to execute anything, we use this instruction.")]),e._v(" "),s("p",[e._v("The EXPOSE instruction informs Docker that the container listens on the specified network ports at runtime. You can specify whether the port listens on TCP or UDP, and the default is TCP if the protocol is not specified. The EXPOSE instruction does not actually publish the port. It functions as a type of documentation between the person who builds the image and the person who runs the container, about which ports are intended to be published. To actually publish the port when running the container, we use the -p flag on docker run.")]),e._v(" "),s("p",[e._v("Now it's time to build the image.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image build -t your_dockerhub_id/node:latest "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(".096kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM node:12\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" cfcf3e70099d\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" WORKDIR /usr/src/app\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 0784285bb528\nRemoving intermediate container 0784285bb528\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 548e712ed3ef\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY package.json "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 3f85bf98e435\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY server.js "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" beb25f72bb6a\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" e3eed8b0c46d\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" notice created a lockfile as package-lock.json. You should commit this file.\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" WARN docker_web_app@1.0.0 No repository field.\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" WARN docker_web_app@1.0.0 No license field.\n\nadded "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("50")]),e._v(" packages from "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("37")]),e._v(" contributors and audited "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("50")]),e._v(" packages "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(".167s\nfound "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" vulnerabilities\n\nRemoving intermediate container e3eed8b0c46d\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 8d3082c10a9e\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" EXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8080")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 0e6bd014ac73\nRemoving intermediate container 0e6bd014ac73\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 5143985531f3\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"server.js"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 152317b9eafe\nRemoving intermediate container 152317b9eafe\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" a832145edf14\nSuccessfully built a832145edf14\nSuccessfully tagged ozgurozturknet/node:latest\n")])])]),s("p",[e._v("Image has been built successfully. But I want you to run the same command one more time.")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(".096kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM node:12\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" cfcf3e70099d\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" WORKDIR /usr/src/app\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 3d04799d4f2a\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY package.json "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" a348cb47ad20\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY server.js "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 5affbe5fce86\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ad11b36a3604\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" EXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8080")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 57b485f4eef1\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"server.js"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" fb0586534394\nSuccessfully built fb0586534394\nSuccessfully tagged ozgurozturknet/node:latest\n")])])]),s("p",[e._v("Something strange has happened. We built the image, after that we didn't change any source file and run the docker image build command second time. We received lots of "),s("code",[e._v("---\x3e Using cache")]),e._v(" outputs this time. What does that mean?")]),e._v(" "),s("p",[e._v("When building an image, Docker steps through the instructions in your Dockerfile, executing each in the order specified. As each instruction is examined, Docker looks for an existing image in its cache that it can reuse, rather than creating a new (duplicate) image. If you don't change any source file or didn't change anything in the Dockerfile, this means that nothing has changed, so Docker doesn't run the instruction again and again and uses the cached instruction. That makes the build process fast. Let's simulate that and see what happens if we change something. Open the "),s("code",[e._v("server.js")]),e._v(" file with a text editor, go to line 12 and change the "),s("code",[e._v("Hello World")]),e._v(" with another message something like "),s("code",[e._v("build cache test")]),e._v(". Save the file and rerun the "),s("code",[e._v("docker image build -t your_dockerhub_id/node:latest .")]),e._v(" command one more time.")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(".096kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM node:12\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" cfcf3e70099d\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" WORKDIR /usr/src/app\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 3d04799d4f2a\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY package.json "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Using cache\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" a348cb47ad20\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY server.js "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 800aa5cd76d2\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 20f6c9a2c4e0\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" notice created a lockfile as package-lock.json. You should commit this file.\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" WARN docker_web_app@1.0.0 No repository field.\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" WARN docker_web_app@1.0.0 No license field.\n\nadded "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("50")]),e._v(" packages from "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("37")]),e._v(" contributors and audited "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("50")]),e._v(" packages "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(".521s\nfound "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" vulnerabilities\n\nRemoving intermediate container 20f6c9a2c4e0\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" eac206f9957e\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" EXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8080")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 3084d34a448f\nRemoving intermediate container 3084d34a448f\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 1e4c0a700aa6\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"server.js"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" b0fae2027731\nRemoving intermediate container b0fae2027731\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 729b13c3276f\nSuccessfully built 729b13c3276f\nSuccessfully tagged ozgurozturknet/node:latest\n")])])]),s("p",[e._v("Docker started to build the image again. First step, nothing changed, used the cache. Second step, nothing changed, used the cache. Third step, nothing changed, used the cache. But fourth step, we wanted to copy server.js file that has been changed. Old layer that docker has cached before is invalid now. So docker started to execute that instruction and created a new layer and didn't use the cached version. And each instruction after that has been executed again and docker didn't use the cache. Because something has changed and the rest of the layers have changed too. So docker can't use the cache for them too. That's kind of important thing to know. Because an image is built during the final stage of the build process, you can minimize image layers by leveraging build cache.")]),e._v(" "),s("p",[e._v("For example, if your build contains several layers, like this, you can order them from the less frequently changed (to ensure the build cache is reusable) to the more frequently changed. If we move  "),s("code",[e._v("COPY server.js .")]),e._v(" from 4. step to anywhere after the "),s("code",[e._v("RUN npm install")]),e._v(" instruction, this means that, we can change anything in this file and Docker will not run npm install each time when we build the image.\n(Visit https://docs.docker.com/develop/develop-images/dockerfile_best-practices/  for Dockerfile best practices)")]),e._v(" "),s("p",[e._v("It's time to create a container from that image and see if it's working properly.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container run --rm -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(":8080 --name node_container your_dockerhub_id/node:latest\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("09a4d1789cdab19a0f3af9c66a4f6e68503e5b8a1f46d6c512e88b10c5e70011\n")])])]),s("p",[e._v("Open a browser and visit http://127.0.0.1 You would see a page with a Hello World! message.")]),e._v(" "),s("p",[e._v("Stop the container and it'll be deleted.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container stop node_container\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("node_container\n")])])]),s("hr"),e._v(" "),s("p",[s("strong",[e._v("4: Multi-stage build")])]),e._v(" "),s("p",[e._v("Let's imagine that we're java developers and working on a new shiny project called App1 (Do you remember our old friend ðŸ˜ƒ). We wrote the code and now it is a good time to check our source code. It's located at "),s("code",[e._v("/trainingdays/day6/apps/java")]),e._v(" folder. cd to that folder and list all the files.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /trainingdays/day6/apps/java\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" -l\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("total "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("135")]),e._v(" Jun "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("22")]),e._v(":43 Dockerfile\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("154")]),e._v(" Jun "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("22")]),e._v(":35 app1.java\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("154")]),e._v(" Jun "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("22")]),e._v(":35 Dockerfile2\n")])])]),s("p",[e._v("There are 2 files in it (actually 3 but let's forget the Dockerfile2 for now). "),s("code",[e._v("app1.java")]),e._v(" is the source code of our application. Please pay attention. It is not the application, it is just the source code. It isn't compiled yet. To convert this source code to an application, we have to compile this code. We generally do that on our computers via IDEs. But we can use the power of Docker and compile our application while building the image too. The Dockerfile in this folder is a good example of that practice. Let's check the Dockerfile.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" Dockerfile\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("FROM mcr.microsoft.com/java/jdk:8-zulu-alpine\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" /usr/src/myapp/\nWORKDIR /usr/src/myapp\nRUN javac app1.java\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"java"')]),e._v(" , "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"app1"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),s("p",[e._v("Again, a simple Dockerfile. We build our image on top of the Java Development Kit image provided by Microsoft. JDK image includes the tools that we use to compile our java code and convert it to a java application. First we copy that source code into image and after that we jump into that folder and run the "),s("code",[e._v("javac app1.java")]),e._v(" command which compiles our application. At the end, we have the CMD instruction that  runs the application whenever we create a container from that image. Let's build the image.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image build -t your_dockerhub_id/java:latest "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(".072kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/5 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM mcr.microsoft.com/java/jdk:8-zulu-alpine\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("-zulu-alpine: Pulling from java/jdk\ndf20fa9351a1: Pull complete\n1e7717fd7ab1: Pull complete\nDigest: sha256:19712872c6dd8ca02a8f727737372477559f2659aa6294c2dcae050096234224\nStatus: Downloaded newer image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" mcr.microsoft.com/java/jdk:8-zulu-alpine\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" b7bb6dd0ee76\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/5 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" /usr/src/myapp/\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ed2f0977e390\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/5 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" WORKDIR /usr/src/myapp\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" d2333b9e9af3\nRemoving intermediate container d2333b9e9af3\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 55a151ddf81a\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v("/5 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" RUN javac app1.java\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" b8697de33caa\nRemoving intermediate container b8697de33caa\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 3bfd240a44ff\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("/5 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"java"')]),e._v(" , "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"app1"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 00a6a2a448ab\nRemoving intermediate container 00a6a2a448ab\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ceab35948e29\nSuccessfully built ceab35948e29\nSuccessfully tagged ozgurozturknet/java:latest\n")])])]),s("p",[e._v("Image has been built. Let's test it.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container run your_dockerhub_id/java:latest\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Hello there"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v(" I'm App1 Java Console Application\n")])])]),s("p",[e._v("Perfect. It works. App1 has been compiled and it runs.  But there seems to be something wrong with that approach. First of all, we built our image on top of the JDK image. It includes lots of tools for development. Like the one that we used to compile our application. But do we really need to send this image to our customers? With all of these development tools? Also our source code is copied to that image too. Maybe that is not something we want. We just wanted to compile our source code and get the application. We want that our customers be able to run this application. Not all the unnecessary tools and source code. Also image size is big. Because of this unnecessary tools that we don't need to run the application. These tools are needed for development. Not needed to run the application. JRE, java runtime is the thing that we need to run the application. It's just the runtime and much smaller than the jdk.")]),e._v(" "),s("p",[e._v("Instead of sending this image, It would be wise to get this compiled application from that image, copy it to our computer and create another image that includes just this application + runtime, instead of application + source code + development tools. So we need to build another image. To be able to do that, we need to create a second Dockerfile. But eeeh. This is a mess. There should be a simple solution.\nYes there is a simple solution to handle this and it's called multi-stage build.")]),e._v(" "),s("p",[e._v("One of the most challenging things about building images is keeping the image size down. Each instruction in the Dockerfile adds a layer to the image, and you need to remember to clean up any artifacts you donâ€™t need before moving on to the next layer. To write a really efficient Dockerfile, you have traditionally needed to employ shell tricks and other logic to keep the layers as small as possible and to ensure that each layer has the artifacts it needs from the previous layer and nothing else. It was actually very common to have one Dockerfile to use for development (which contained everything needed to build your application), and a slimmed-down one to use for production, which only contained your application and exactly what was needed to run it. This has been referred to as the â€œbuilder patternâ€. But maintaining two Dockerfiles is not ideal.")]),e._v(" "),s("p",[e._v("With multi-stage builds, you use multiple FROM statements in your Dockerfile. Each FROM instruction can use a different base, and each of them begins a new stage of the build. You can selectively copy artifacts from one stage to another, leaving behind everything you donâ€™t want in the final image. Dockerfile2 is a perfect example of this kind of multi-stage build. Let's check it.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" Dockerfile2\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("FROM mcr.microsoft.com/java/jdk:8-zulu-alpine AS builder\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" /usr/src/myapp/\nWORKDIR /usr/src/myapp\nRUN javac app1.java\n\nFROM  mcr.microsoft.com/java/jre:8-zulu-alpine\nWORKDIR /usr/src/myapp\nCOPY --from"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("builder /usr/src/myapp "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"java"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"app1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),s("p",[e._v("As you can see, now we have a Dockerfile with 2 FROM instructions. First part is the same as the original Dockerfile that we have built our application a few minutes ago. There are only 2 differences. First, there is a new section at the end of the FROM instruction. \"AS builder\" or it could be AS anything, just name it. It indicates that this first section is tagged as builder. We're gonna use this tag in the second section. Second difference is that CMD instruction has been removed, because we don't need it anymore. This \"builder\" stage is just for compiling the application from its source code. We take our source code, copy it into this jdk image, compile the application and that's it. After that we start to build our actual image with a new FROM instruction. This is the final image that will be created at the end. It's based on JRE image, not the JDK. The COPY --from=builder line copies just the built artifact from the previous stage into this new stage. The JDK and any intermediate artifacts are left behind, and not saved in the final image. The end result is the tiny production image that just includes the application. Not the source code and not the development tools. Let's build this image and see what's going on.\n(We're gonna use "),s("code",[e._v("-f")]),e._v(" option to point this Dockerfile2. We use the -f flag with docker build to point a Dockerfile named other than Dockerfile or not located in the folder that we run the command)")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image build -f Dockerfile2 -t your_dockerhub_id/finaljava:latest "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(".096kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM mcr.microsoft.com/java/jdk:8-zulu-alpine AS builder\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" b7bb6dd0ee76\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" /usr/src/myapp/\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 786a33a37acb\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" WORKDIR /usr/src/myapp\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 1145e3882420\nRemoving intermediate container 1145e3882420\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 5f16de8216fb\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" RUN javac app1.java\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 98375300d10a\nRemoving intermediate container 98375300d10a\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" f632a0c6f49e\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM  mcr.microsoft.com/java/jre:8-zulu-alpine\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("-zulu-alpine: Pulling from java/jre\ndf20fa9351a1: Already exists\nb391ad10af71: Pull complete\nDigest: sha256:bb7135444a7e78448b0038d26079e6bef78c1c7839333bf9806d6c12e65a1eff\nStatus: Downloaded newer image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" mcr.microsoft.com/java/jre:8-zulu-alpine\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 36c60fc08a2d\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" WORKDIR /usr/src/myapp\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 25809e0fd983\nRemoving intermediate container 25809e0fd983\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 5b580490d819\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY --from"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("builder /usr/src/myapp "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" e357def56d05\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("/8 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"java"')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"app1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" 00585394dbfb\nRemoving intermediate container 00585394dbfb\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 7b7c6b3a7f6a\nSuccessfully built 7b7c6b3a7f6a\nSuccessfully tagged ozgurozturknet/finaljava:latest\n")])])]),s("p",[e._v("Final image has been built. It's much smaller than the first one and also just includes the artifacts that we need.")]),e._v(" "),s("hr"),e._v(" "),s("p",[s("strong",[e._v("5: Php contacts app")])]),e._v(" "),s("p",[e._v("This time we're gonna combine what we have learn so far. We will build 2 images. First one is a simple php application. The other one is mysql database. After that we will run these and try the tricks that we have learned so far. First let's check the files and see what we're gonna build. All are located at "),s("code",[e._v("/trainingdays/day6/apps/php")]),e._v(" folder. cd to that folder and list all the files.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /trainingdays/day6/apps/php\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" -l\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("total "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("24")]),e._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("333")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":54 Dockerfile\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("64")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":36 Dockerfile.mysql\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("112")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":36 createtable.sql\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("81")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":36 env.list\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" ozozturk ozozturk  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("107")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":36 envmysql.list\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" ozozturk ozozturk "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4096")]),e._v(" Aug "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("13")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(":35 php\n")])])]),s("p",[e._v("It's a little bit crowded folder. There are 2 Dockerfiles. First one is the Dockerfile that we'll build the web app image. Second one is the mysql database image.")]),e._v(" "),s("p",[e._v("There are also 2 enviroment variable files. With env.list, we'll pass connection strings to the web app, so It will know how to connect the database \"username, password, databasename etc.\". envmysql.list is the enviroment variable file that we'll pass to the mysql container. It'll start and create the database with these parameters. Essentially, we could inject these variables inside the Dockerfiles. Yes it's possible. We can define enviroment variables with "),s("code",[e._v("ENV")]),e._v(" instruction but if we do that, these will hardcoded inside the image. This means that whoever get this image can access these values. Specially this isn't a thing that we want for sensitive data like passwords. Therefore we didn't put these into images. Instead of that, we will pass these while creating the containers.")]),e._v(" "),s("p",[e._v("createtable.sql is an sql script that will create the table that our php application stores its data. We'll copy this file to the image and when we create a container from that image, a simple table will be created.")]),e._v(" "),s("p",[e._v("php is the folder where our main web app is located. Inside this folder, there are 3 files. It's really simple web app which allows you to record contact details. Kind of primitive crm. Let's have a look at Dockerfiles before building the images.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" Dockerfile\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("FROM php:7.3-apache\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" update -y "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" mariadb-client-10.3 -y\nRUN docker-php-ext-install mysqli "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" docker-php-ext-enable mysqli\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" /var/www/html/images\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("777")]),e._v(" /var/www/html/images\nCOPY ./php/ /var/www/html/\nHEALTHCHECK --interval"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("30s --timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("3s CMD "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -f http://localhost/ "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n")])])]),s("p",[e._v("We use official php image as our base. Then we install couple of binaries that we need and create a folder where we'll store uploaded images and after that we copy our web app into the image. So far nothing unknown. But now we have a new instruction which is HEALTHCHECK. The HEALTHCHECK instruction tells Docker how to test a container to check that it is still working. This can detect cases such as a web server that is stuck in an infinite loop and unable to handle new connections, even though the server process is still running so the container is up. When a container has a healthcheck specified, it has a health status in addition to its normal status. Therefore we can monitor our container's real status and take action if something goes wrong. In our case, we want from Docker that each container created from that image will start a healthchecking process and continue to check every 30 seconds. If container will get a response from http://localhost/, Docker will mark it as healthy, otherwise unhealthy.")]),e._v(" "),s("p",[e._v("All good but there's one thing strange. We don't have any CMD instruction in this file. So how will the container know which application to run when it starts? Answer is really simple. When you build an image, Docker inherits all settings from the base image. If you specify anything on your Dockerfile, it overwrites the value of the base image. But if you left it blank, Image uses the value of the base image. In our case, we don't have the CMD instruction, so Docker will inherit this from base image. That's enough for the first Dockerfile. Let's take have a look at the mysql's Dockerfile too.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" Dockerfile\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("FROM mysql:5.7\nCOPY createtable.sql /docker-entrypoint-initdb.d\n")])])]),s("p",[e._v("This is really short. We're gonna use mysql:5.7 as our base and copy createtable.sql to the /docker-entrypoint-initdb.d folder. When a mysql container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables. Furthermore, it will execute files with extensions .sh, .sql and .sql.gz that are found in /docker-entrypoint-initdb.d. So we copy our sql script to this folder and when a container starts from that image, it'll create our table.  (See https://hub.docker.com/_/mysql for details)")]),e._v(" "),s("p",[e._v("It's time to build the images.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image build -t your_dockerhub_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("php:v1 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(".26kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM php:7.3-apache\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" update -y "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" mariadb-client-10.3 -y\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" dca6dcd061df\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("â€¦"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("â€¦"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("â€¦"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" HEALTHCHECK --interval"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("30s --timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("3s CMD "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -f http://localhost/ "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" d6dc02b8ca50\nRemoving intermediate container d6dc02b8ca50\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" bf3e03646cc0\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),e._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY ./php/ /var/www/html/\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 53959f571f38\nSuccessfully built 53959f571f38\nSuccessfully tagged ozgurozturknetphp:v1\n")])])]),s("p",[e._v("Php image is ready. Let's build the mysql now.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker image build -f Dockerfile.mysql -t your_dockerhub_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("mysql:v1 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("11")]),e._v(".26kB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/2 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" FROM mysql:5.7\nStatus: Downloaded newer image "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" mysql:5.7\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 718a6da099d8\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" COPY createtable.sql /docker-entrypoint-initdb.d\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" 2dfc8038fc98\nSuccessfully built 2dfc8038fc98\nSuccessfully tagged ozgurozturknetmysql:v1\n")])])]),s("p",[e._v("Done. Images are ready. It's time to run our application but first let's create a new bridge network. Our php web site will access to mysql database by its name. Therefore, these containers must be able to resolve each others name.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker network create php-mysql-net\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("f3b75a829c3f7a8d5268dbf9dcb884071b3affaed642b3fe6354e78193d054c6\n")])])]),s("p",[e._v("Images are ready. Bridge network has been created. We're ready to run the containers.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container run -d --name phpapp --network php-mysql-net -p "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(":80 --env-file env.list your_dockerhub_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("php:v1\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("c580f355ad836c1021ee5959970bdf53c93de088c701af4110e1dfd8e976a80b\n")])])]),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container run -d --name mysqldb --network php-mysql-net --env-file envmysql.list your_dockerhub_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("mysql:v1\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("02d51c5ad53c0f1fd0679a5b0f4b60a742a07eecd9eb2f7eebbb8eb800bed73e\n")])])]),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ps")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("CONTAINER ID        IMAGE                    COMMAND                  CREATED              STATUS                        PORTS                 NAMES\n02d51c5ad53c        ozgurozturknetmysql:v1   "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"docker-entrypoint.sâ€¦"')]),e._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("53")]),e._v(" seconds ago       Up "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("52")]),e._v(" seconds                 "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3306")]),e._v("/tcp, "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("33060")]),e._v("/tcp   mysqldb\nc580f355ad83        ozgurozturknetphp:v1     "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"docker-php-entrypoiâ€¦"')]),e._v("   About a minute ago   Up About a minute "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("healthy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.0")]),e._v(".0.0:80-"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("/tcp    phpapp\n")])])]),s("p",[e._v("Containers are up and running and also phpapp's status is healthy. Let's open a browser and see if the webapp is also working and can connect to mysql database. Visit http://127.0.0.1")]),e._v(" "),s("img",{attrs:{src:a(674)}}),e._v(" "),s("p",[e._v("Fill the form and click add.")]),e._v(" "),s("img",{attrs:{src:a(675)}}),e._v(" "),s("p",[e._v("If you saw this message, everything is fine. Click View and check your records.")]),e._v(" "),s("img",{attrs:{src:a(676)}}),e._v(" "),s("p",[e._v("Congratulations! You have successfully built a 2 tier web app and run that.")]),e._v(" "),s("p",[e._v("Now we can stop and delete the containers. Please don't delete the images for now. We need them on the next challenge.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" -f mysqldb phpapp\n")])])]),s("hr"),e._v(" "),s("p",[s("strong",[e._v("6: Docker commit")])]),e._v(" "),s("p",[e._v("Dockerfile is not the only way to create an image. We can convert a container to an image too. It can be useful to commit a containerâ€™s file changes or settings into a new image. This allows you to debug a container by running an interactive shell, or to export a working dataset to another server. Generally, it is better to use Dockerfiles to manage your images in a documented and maintainable way, but sometimes this type of commit method is also needed. Let's try this. First let's create a container and create a file in it.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker container run -it --name commit_test busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v("\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# mkdir /test")]),e._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# cd /test")]),e._v("\n/test "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# touch test.txt")]),e._v("\n/test "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# echo "hello world" > test.txt')]),e._v("\n/test "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# exit")]),e._v("\n")])])]),s("p",[e._v("Let's assume that we have an important container. We connected to it made lots of changes. Created folders and files, installed something etc. We don't want to loose our efforts and keep this container as an image. So we can move it anywhere. Let's commit this container and convert it to an image.")]),e._v(" "),s("p",[e._v("Type:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("$ docker commit commit_test ozgurozturknet/commit:latest\n")])])]),s("p",[e._v("Output will be something like:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("sha256:8f5d8a8e42bd9419f6a932c0e70b0700f0618096d6c3f4a06753520fac236ed7\n")])])]),s("p",[e._v("Our image is ready. Now if we want, we can push it to our repository and move it to anywhere we want.")]),e._v(" "),s("h2",{attrs:{id:"wrap-up"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wrap-up"}},[e._v("#")]),e._v(" Wrap up")]),e._v(" "),s("p",[s("strong",[e._v("Congratulations")]),e._v(" you have completed the Image and Registry challenge. You've just learned how to create Docker images and play with them.")]),e._v(" "),s("p",[e._v("*** Reference: https://docs.docker.com")])])}),[],!1,null,null,null);t.default=n.exports}}]);