(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{771:function(t,e,a){"use strict";a.r(e);var v=a(42),n=Object(v.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"break-out-integrate-the-sample-application-into-azure-ad"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#break-out-integrate-the-sample-application-into-azure-ad"}},[t._v("#")]),t._v(" Break Out: Integrate the sample application into Azure AD")]),t._v(" "),a("h2",{attrs:{id:"here-is-what-you-will-learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn"}},[t._v("#")]),t._v(" Here is what you will learn")]),t._v(" "),a("p",[t._v("Deploy the sample application with Azure AD Integration.")]),t._v(" "),a("p",[t._v("In "),a("RouterLink",{attrs:{to:"/day5/challenges/challenge-3.html"}},[t._v("challenge-3")]),t._v(" we already created the needed Azure AD applications to integrate the SCM Contacts API into Azure AD. We acquired an access_token from Azure AD and made a request to the API. Now it's time to integrate all APIs of the sample application into Azure AD.")],1),t._v(" "),a("p",[t._v("Here is the list of the remaining services we have to integrate into Azure AD:")]),t._v(" "),a("ul",[a("li",[t._v("SCM Resource API")]),t._v(" "),a("li",[t._v("SCM Search API")]),t._v(" "),a("li",[t._v("SCM Visitreports API")]),t._v(" "),a("li",[t._v("SCM Textanalytics")]),t._v(" "),a("li",[t._v("SCM Frontend")])]),t._v(" "),a("blockquote",[a("p",[t._v("If you started this day based on the checkpoint, please "),a("RouterLink",{attrs:{to:"/day5/apps/checkpoint/ChallengeAndBreakout.html#modified-steps-for-break-out-session"}},[a("strong",[t._v("follow\nthis link")])]),t._v(" to see an adopted guide.")],1)]),t._v(" "),a("p",[t._v("As in "),a("RouterLink",{attrs:{to:"/day5/challenges/challenge-3.html"}},[t._v("challenge-3")]),t._v(" we always perform the following steps for each service:")],1),t._v(" "),a("ol",[a("li",[t._v("Create and checkout a new branch")]),t._v(" "),a("li",[t._v("Edit the the existing build definition and change everything from "),a("code",[t._v("day4")]),t._v(" to "),a("code",[t._v("day5")])]),t._v(" "),a("li",[t._v("Save the definition, commit the changes and push the branch to the remote repository")]),t._v(" "),a("li",[t._v("Run the build targeting the feature branch")]),t._v(" "),a("li",[t._v("Edit the Release defintion, add the needed variables and adjust the deployment tasks")]),t._v(" "),a("li",[t._v("Run the Release build")]),t._v(" "),a("li",[t._v("Merge the feature branch into the master branch")])]),t._v(" "),a("p",[t._v("We don't need to create additional Azure AD applications for the remaining services. All APIs uses the same Azure AD application that we already created in "),a("RouterLink",{attrs:{to:"/day5/challenges/challenge-3.html"}},[t._v("challenge-3")]),t._v(" for each stage (Development and Production). The Frontend services uses the client application.")],1),t._v(" "),a("p",[a("strong",[t._v("Note:")]),t._v(" Be carefull that you don't confuse the IDs of the stage "),a("code",[t._v("Development")]),t._v(" and "),a("code",[t._v("Testing")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"scm-resource-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scm-resource-api"}},[t._v("#")]),t._v(" SCM Resource API")]),t._v(" "),a("p",[t._v("Feature branch: "),a("strong",[t._v("features/scmresourcesaad")])]),t._v(" "),a("p",[t._v("Build definition yaml: "),a("strong",[t._v("scm-resources-ci.yaml")])]),t._v(" "),a("p",[t._v("Release defintion: "),a("strong",[t._v("SCM-Resources-CD")])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Development")]),t._v(":")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")]),t._v(" "),a("th",[t._v("ARM Template parameter")]),t._v(" "),a("th",[t._v("Stage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadInstance")]),t._v(" "),a("td",[t._v("https://login.microsoftonline.com")]),t._v(" "),a("td",[t._v("aadInstance")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientId")]),t._v(" "),a("td",[t._v("API AppId, the value that you received from the output when you created the Azure AD application")]),t._v(" "),a("td",[t._v("aadClientId")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("The id of your Azure AD Tenant")]),t._v(" "),a("td",[t._v("aadTenantId")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadDomain")]),t._v(" "),a("td",[t._v("The domain name of your Azure AD e.g. azuredevcollege.onmicrosoft.com")]),t._v(" "),a("td",[t._v("aadDomain")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-dev")]),t._v(" "),a("td",[t._v("aadClientIdUri")]),t._v(" "),a("td",[t._v("Development")])])])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Testing")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")]),t._v(" "),a("th",[t._v("ARM Template parameter")]),t._v(" "),a("th",[t._v("Stage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadInstance")]),t._v(" "),a("td",[t._v("https://login.microsoftonline.com")]),t._v(" "),a("td",[t._v("aadInstance")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientId")]),t._v(" "),a("td",[t._v("API AppId, the value that you received from the output when you created the Azure AD application for stage Testing")]),t._v(" "),a("td",[t._v("aadClientId")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("The id of your Azure AD Tenant")]),t._v(" "),a("td",[t._v("aadTenantId")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadDomain")]),t._v(" "),a("td",[t._v("The domain name of your Azure AD e.g. azuredevcollege.onmicrosoft.com")]),t._v(" "),a("td",[t._v("aadDomain")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-test")]),t._v(" "),a("td",[t._v("aadClientIdUri")]),t._v(" "),a("td",[t._v("Testing")])])])]),t._v(" "),a("h2",{attrs:{id:"scm-search-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scm-search-api"}},[t._v("#")]),t._v(" SCM Search API")]),t._v(" "),a("p",[t._v("Feature branch: "),a("strong",[t._v("features/scmsearchaad")])]),t._v(" "),a("p",[t._v("Build definition yaml: "),a("strong",[t._v("scm-search-ci.yaml")])]),t._v(" "),a("p",[t._v("Release definition: "),a("strong",[t._v("SCM-Search-CD")])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Development")]),t._v(":")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")]),t._v(" "),a("th",[t._v("ARM Template parameter")]),t._v(" "),a("th",[t._v("Stage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadInstance")]),t._v(" "),a("td",[t._v("https://login.microsoftonline.com")]),t._v(" "),a("td",[t._v("aadInstance")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientId")]),t._v(" "),a("td",[t._v("API AppId, the value that you received from the output when you created the Azure AD application")]),t._v(" "),a("td",[t._v("aadClientId")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("The id of your Azure AD Tenant")]),t._v(" "),a("td",[t._v("aadTenantId")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadDomain")]),t._v(" "),a("td",[t._v("The domain name of your Azure AD e.g. azuredevcollege.onmicrosoft.com")]),t._v(" "),a("td",[t._v("aadDomain")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-dev")]),t._v(" "),a("td",[t._v("aadClientIdUri")]),t._v(" "),a("td",[t._v("Development")])])])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Testing")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")]),t._v(" "),a("th",[t._v("ARM Template parameter")]),t._v(" "),a("th",[t._v("Stage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadInstance")]),t._v(" "),a("td",[t._v("https://login.microsoftonline.com")]),t._v(" "),a("td",[t._v("aadInstance")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientId")]),t._v(" "),a("td",[t._v("API AppId, the value that you received from the output when you created the Azure AD application for stage Testing")]),t._v(" "),a("td",[t._v("aadClientId")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("The id of your Azure AD Tenant")]),t._v(" "),a("td",[t._v("aadTenantId")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadDomain")]),t._v(" "),a("td",[t._v("The domain name of your Azure AD e.g. azuredevcollege.onmicrosoft.com")]),t._v(" "),a("td",[t._v("aadDomain")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-test")]),t._v(" "),a("td",[t._v("aadClientIdUri")]),t._v(" "),a("td",[t._v("Testing")])])])]),t._v(" "),a("h2",{attrs:{id:"scm-visitreports-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scm-visitreports-api"}},[t._v("#")]),t._v(" SCM VisitReports API")]),t._v(" "),a("p",[t._v("Feature branch: "),a("strong",[t._v("features/scmvisitreportsaad")])]),t._v(" "),a("p",[t._v("Build definition yaml: "),a("strong",[t._v("scm-visitreports-ci.yaml")])]),t._v(" "),a("p",[t._v("Release definition: "),a("strong",[t._v("SCM-VisitReports-CD")])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Development")]),t._v(":")]),t._v(" "),a("p",[a("strong",[t._v("Note:")]),t._v(" You only need to adjust the deployment task that uses the ARM template "),a("strong",[t._v("scm-visitreport-nodejs-infra.json")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")]),t._v(" "),a("th",[t._v("ARM Template parameter")]),t._v(" "),a("th",[t._v("Stage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("The id of your Azure AD Tenant")]),t._v(" "),a("td",[t._v("aadTenantId")]),t._v(" "),a("td",[t._v("Development")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-dev")]),t._v(" "),a("td",[t._v("aadClientIdUri")]),t._v(" "),a("td",[t._v("Development")])])])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Testing")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")]),t._v(" "),a("th",[t._v("ARM Template parameter")]),t._v(" "),a("th",[t._v("Stage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("The id of your Azure AD Tenant")]),t._v(" "),a("td",[t._v("aadTenantId")]),t._v(" "),a("td",[t._v("Testing")])]),t._v(" "),a("tr",[a("td",[t._v("AadClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-test")]),t._v(" "),a("td",[t._v("aadClientIdUri")]),t._v(" "),a("td",[t._v("Testing")])])])]),t._v(" "),a("h2",{attrs:{id:"scm-textanalytics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scm-textanalytics"}},[t._v("#")]),t._v(" SCM Textanalytics")]),t._v(" "),a("p",[t._v("Feature branch: "),a("strong",[t._v("features/scmtextanalyticsaad")])]),t._v(" "),a("p",[t._v("Build definition yaml: "),a("strong",[t._v("scm-textanalytics-ci.yaml")])]),t._v(" "),a("p",[t._v("Release definition: "),a("strong",[t._v("SCM-TextAnalytics-CD")])]),t._v(" "),a("p",[a("strong",[t._v("Note:")]),t._v(" As the service SCM TextAnalytics does not offer an accessible API there is no need to adjust the Release build. We only need to adjust the build definition, create a new build and deploy it to Azure.")]),t._v(" "),a("h2",{attrs:{id:"scm-frontend"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scm-frontend"}},[t._v("#")]),t._v(" SCM Frontend")]),t._v(" "),a("p",[t._v("Feature branch: "),a("strong",[t._v("features/scmfrontendaad")])]),t._v(" "),a("p",[t._v("Build definition yaml: "),a("strong",[t._v("scm-frontend-ci.yaml")])]),t._v(" "),a("p",[t._v("Release definition: "),a("strong",[t._v("SCM-Frontend-CD")])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Development")]),t._v(":")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("the Id of your Azure Ad Tenant")])]),t._v(" "),a("tr",[a("td",[t._v("AadApiClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-dev")])]),t._v(" "),a("tr",[a("td",[t._v("AadFrontendClientId")]),t._v(" "),a("td",[t._v("UI AppId, the value that you received from the output when you created the Azure AD application for stage Development")])])])]),t._v(" "),a("p",[t._v("CD Build variables for stage "),a("strong",[t._v("Testing")]),t._v(":")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AadTenantId")]),t._v(" "),a("td",[t._v("the Id of your Azure Ad Tenant")])]),t._v(" "),a("tr",[a("td",[t._v("AadApiClientIdUri")]),t._v(" "),a("td",[t._v("http://scmapi-test")])]),t._v(" "),a("tr",[a("td",[t._v("AadFrontendClientId")]),t._v(" "),a("td",[t._v("UI AppId, the value that you received from the output when you created the Azure AD application for stage Testing")])])])]),t._v(" "),a("p",[a("strong",[t._v("Note")]),t._v(" As on Day4 we have to configure the settings for the SCM Frontend. Adjust the Azure CLI task which applies the settings to "),a("code",[t._v("dist/settings.js")]),t._v(" as follows:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('echo "var uisettings = { \\"tenantId\\": \\"$(AadTenantId)\\", \\"audience\\": \\"$(AadApiClientIdUri)\\", \\"clientId\\": \\"$(AadFrontendClientId)\\", \\"enableStats\\": true, \\"endpoint\\": \\"$(ContactsEndpoint)\\", \\"resourcesEndpoint\\": \\"$(ResourcesEndpoint)\\", \\"searchEndpoint\\": \\"$(SearchEndpoint)\\", \\"reportsEndpoint\\": \\"$(ReportsEndpoint)\\", \\"aiKey\\": \\"`az resource show -g $(ResourceGroupName) -n $(ApplicationInsightsName) --resource-type "microsoft.insights/components" --query "properties.InstrumentationKey" -o tsv`\\" };" > $(System.ArtifactsDirectory)/_SCM-Frontend-CI/drop/dist/settings/settings.js\n')])])]),a("blockquote",[a("p",[t._v("Please skip this step if you've started on the checkpoint, the correct\nvariable replacement should already be in place.")])]),t._v(" "),a("p",[t._v("Make sure that you copy the whole line!")]),t._v(" "),a("h2",{attrs:{id:"wrap-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wrap-up"}},[t._v("#")]),t._v(" Wrap up")]),t._v(" "),a("p",[t._v("You've done it. There is nothing more to add, just test the application and enjoy your success ðŸ˜ƒ")])])}),[],!1,null,null,null);e.default=n.exports}}]);